<?php
//error_reporting(E_ALL);
//ini_set("display_errors",1);
ob_start();

$accessarray = array(
    '1' , '14'
);

function clean($string) {
    $string = str_replace(' ', 'nbsp', $string);
    $string = str_replace(',', 'mmmm', $string);
    $string = str_replace("â€™", '`', $string);
    $string = str_replace('-', '-', $string);
    $string = str_replace('/', 'kkkk', $string); // Replaces all spaces with hyphens.
    $string = str_replace("'", '`', $string);
    $string = str_replace(".", 'cccc', $string);
    $string = preg_replace('/[^A-Za-z0-9\-]/', '', $string);
    $string = str_replace('nbsp', ' ', $string);
    $string = str_replace('kkkk', '/', $string);
    $string = str_replace("`", "'", $string);
    $string = str_replace("cccc", '.', $string);
    $string = str_replace("mmmm", ',', $string);
    return $string;
}

include ('session/session.php');
include ('./PHPExcel.php');
include ('./PHPExcel/IOFactory.php');
include ('./PHPExcel/Reader/Excel2007.php');
include ('./PHPExcel/Writer/Excel2007.php');

$option_for = array(
    1 => 'AGT',
    2 => 'Representation',
    3 => 'Promotion'
);

$option_type = array(
    1 => 'Stations',
    2 => 'Regions'
);

$option_status_arr = array(
    1 => 'Unfilled',
    2 => 'Pending at CCA',
    3 => 'CCA Approved',
    4 => 'CCA Rejected',
    5 => 'DBC Printed',
    6 => 'Closed'
);

$option_assign_status_arr = array(
    0 => 'All',
    1 => 'Assigned',
    2 => 'Unassigned'
);

$reason_arr = array(
    1 => 'Working spouse',
    2 => 'Medical grounds',
    3 => 'Education of children',
    4 => 'Others'
);

if (isset($retirement_data))
    $los_heading = 'Length of Service (Ret. Date) (' . $retirement_data->retirement_date . ')';
else
    $los_heading = 'Length of Service (Ret. Date)';
$heading = array(
    'Civil Code',
    'Batch',
    'Name',
    'Post Desc.',
    '<span class="post-code">Post Code Sequence</span>',
    'Station',
    'Current CCA',
    '<span class="doj">DOJ Current Region (' . date('d-m-Y', time()) . ')</span>',
    '<span class="stay-rwgion">Stay In Current Region</span>',
    '<span class="stay-rwgion">Continuous Stay At Present Region</span>',
    '<span class="stay-rwgion">Continuous Stay At Present Station </span>',
    '<span class="stay-rwgion">Stay In other regions</span>',
    'Trns. Req.?',
    '<span class="option">Option 1</span>',
    '<span class="option">Option 2</span>',
    '<span class="option">Option 3</span>',
    '<span class="option">Option 4</span>',
    '<span class="option">Option 5</span>',
    '<span class="option">Option 6</span>',
    '<span class="option">Option 7,</span>',
    'HomeState',
    'Authenticated',
    'CCA Authentication 	',
    $los_heading,
    'Reason',
    'Option Status',
    'Specification',
    'CCA Remarks',
    'Option Filled Date',
    'Option Window No',
    'DBC Remarks'
);

if (isset($retirement_data))
    $los_heading = 'Length of Service (Ret. Date) (' . $retirement_data->retirement_date . ')';
else
    $los_heading = 'Length of Service (Ret. Date)';

$heading1 = array(
    'Civil Code',
    'Batch',
    'Name',
    'Post Desc.',
    'Post Code Sequence',
    'Station',
    'Current CCA',
    'DOJ Current Region (' . date('d-m-Y', time()) . ')',
    'Total Stay at Present Region',
    'Continuous Stay at Present Region',
    'Continuous Stay at Present Station',
	'Stay In other regions',
    'Trns. Req.?',
    'Option 1',
    'Option 2',
    'Option 3',
    'Option 4',
    'Option 5',
    'Option 6',
    'Option 7',
    'Options Text',
    'HomeState',
    'Authenticated',
    'CCA Authentication',
    $los_heading,
    'Reason',
    'Option Status',
    'Specification',
    'CCA Remarks',
    'Option Filled Date',
    'Option Window No',
    'DBC Remarks'
);

$newPTDAO = new PostTypeDAO();
$tempRankDAO = new RankDAO ();
$tempOptionFlagDAO = new OptionFlagDAO ();
$tempStatusDAO = new StatusDAO ();
$tempRegionDAO = new OptionRegionDAO ();
$tempStationDAO = new StationDAO ();
$tempPostingDAO = new PostingDAO ();
$tempStgPostingsDAO = new StgPostingsDAO ();
$tempOfficerDAO = new OfficerDAO ();
$tempStateDAO = new StateDAO ();
$tempRetirementVO = new RetirementVO ();
$tempRetirementDAO = new RetirementDAO ();
$retirement_data = $tempRetirementDAO->getRetirementDate();
$status_list = $tempStatusDAO->getAllStatusList();
$rank_list = $tempRankDAO->getAllRankList();
$option_window_list = $tempOptionFlagDAO->getAllOptions();

$cond = ' 1 = 1 ';
$assign = ' ';

$assign_status = 0;


if ($_SERVER ['REQUEST_METHOD'] == "POST" && $_POST ['actionType'] == 'search') {

    extract($_POST);

    // if($option_window != '') $cond .= ' AND a.option_id = '.$option_window.'';

    if ($rank != '') {
        $cond .= " AND o.rankid = '" . $rank . "' ";
    }

    if ($batch != '') {
        $cond .= " AND o.batch = '" . $batch . "' ";
    }

    if ($status != '') {
        $cond .= " AND o.status = '" . $status . "' ";
    }

    if ($batch != '') {
        $cond .= " AND o.batch = '" . $batch . "' ";
    }

    if (isset($latest) && $latest != '') {
        $latest = 1;
    } else {
        $latest = '';
    }

  /* if ($civil_code != '') {
        $cond .= " AND o.civilCode = '" . $civil_code . "' ";
    } */
	///Added by Shalini to search by muliple civil codes

    if ($name != '') {
        $cond .= " AND o.name LIKE '%" . $name . "%' ";
    }

    if ($option_assign_status == 1) {
        $assign .= ' AND a.option_id = ' . $option_window . '';
        $assign_status = 1;
    }

    if ($option_assign_status == 2) {
        $assign .= ' AND a.option_id IS NULL';
        $assign_status = 2;
    }

    if ($option_assign_status == 0) {
        $assign .= ' AND a.option_id = ' . $option_window . '';
    }

    if ($option_status != '') {
        $assign .= " AND a.option_status = '" . $option_status . "' ";
    }

    if (isset($wslist) && $reason == 1) {
        $sub_reason = implode(',', $wslist);
    } else if (isset($medlist) && $reason == 2) {
        $sub_reason = implode(',', $medlist);
    } else if (isset($edulist) && $reason == 3) {
        $sub_reason = implode(',', $edulist);
    } else {
        $sub_reason = NULL;
    }

    if (isset($retirement_date) && isset($redit_id)) {
        $tempRetirementVO->retirement_date = $retirement_date;
        $tempRetirementVO->id = $redit_id;
        $update = $tempRetirementDAO->update($tempRetirementVO, $redit_id);
    }

    $retirement_data = $tempRetirementDAO->getRetirementDate();
    $officer_list = $tempOptionFlagDAO->getOfficersListForReport($option_window_for, $option_window, $option_window_no, $option_status, $region, $rank, $transfer, $optionRegion, $city, $batch, $sort, $flagid, $duestatus, $reason, $sub_reason, $latest, $civil_code);

    if ($s_opt_no != '') {
        foreach ($officer_list as $officer_data) {
            $option = $tempOptionFlagDAO->get_option_data($officer_data->assign_id, $officer_data->option_id);
            $opt = explode(',', $option [0]->options);
            if ($city == $opt [($s_opt_no - 1)]) {
                $temp_officer_list [] = $officer_data;
            }
        }
        $officer_list = $temp_officer_list;
    }

    if ($r_opt_no != '') {
        foreach ($officer_list as $officer_data) {
            $option = $tempOptionFlagDAO->get_option_data($officer_data->assign_id, $officer_data->option_id);
            $opt = explode(',', $option [0]->options);
            if ($optionRegion == $opt [($r_opt_no - 1)]) {
                $temp_officer_list [] = $officer_data;
            }
        }
        $officer_list = $temp_officer_list;
    }
    $postingList = $tempOfficerDAO->getPostingDetails();

    if ($_POST ['excel'] == "excel") {

        $l = 0;

        foreach ($officer_list as $officer_data) {

            /*  Code coment by nishant on 01-03-2018
			$tempPostingVO = $tempPostingDAO->getOptionPostingListForOfficer($officer_data->officer_id);
			
			*/
			$tempPostingVO = $tempPostingDAO->getOptionPostingListForOfficerLastPosting($officer_data->officer_id);
			
            $cityname = getColumnName($tempPostingVO->getCityid(), 'cities');
            $officercurrentregion = $tempStgPostingsDAO->getDueListCurrentPCity($officer_data->officer_id);
            //$regiondoj = $tempStgPostingsDAO->getLastPostingByRegion($officer_data->officer_id, $officercurrentregion);
            $option_detail = $tempOptionFlagDAO->getOption($officer_data->option_id);
            $option = $tempOptionFlagDAO->get_option_data($officer_data->assign_id, $officer_data->option_id);
            //22-02-2017
            $stgPostingList = $tempStgPostingsDAO->getPostingListForOfficer($officer_data->officer_id, "false");
            // new code
            $postingsOfficer = $tempStgPostingsDAO->getPostingListForMultipleOfficer (array($officer_data->officer_id), $showAdditionalCharge = '' );
            $stgPostingListNew = $postingsOfficer [$officer_data->officer_id];
            $regiondoj = $tempStgPostingsDAO->getLastJoiningDateByRegion ($officer_data->officer_id, $officercurrentregion,$stgPostingListNew, 'region', "Yes", "No");

            for ($cnt = 0; $cnt < count($stgPostingList); $cnt++) {
                $tempListPostingVO = $stgPostingList[$cnt];
                $islastposting = $tempListPostingVO->getislastPosting();
                if ($islastposting == 1 || $cnt == count($stgPostingList) - 1) {
                    $stationid = $tempListPostingVO->getCity();
                    $currentReigonId = $tempListPostingVO->getRegion();
                }
            }

            $stay_at_cur_region = $newPTDAO->continuousStayAtPresntStationPro($officer_data->officer_id, $currentReigonId, $stgPostingList, 'region', "Yes", "No");
            $stay_at_cur_station = $newPTDAO->continuousStayAtPresntStationPro($officer_data->officer_id, $stationid, $stgPostingList, 'city', "No", "No");
            $datum = $newPTDAO->getTotalStayOnRegionStationWise($stgPostingList, 'region');
			$stay_in_other_regions = '';
                                    foreach ($datum as $d) {
                                        $stay_in_other_regions .=  $d['RegionName'] . ' : ' . $d['Duration'] . "\n";
                                    }
			
			//22-02-2017 end

            /* comment by nishant on 01-03-2018
		   $data_arr = array(
                $l + 1,
                $officer_data->civilCode,
                $officer_data->batch,
                $officer_data->name,
                $tempPostingVO->getDescription(),
                $tempPostingVO->getSequence(),
                $cityname,
                $tempRegionDAO->getRegion($tempPostingVO->getRegionid())->getName(),
                getFormattedDate($regiondoj),
                ucwords(strtolower($tempOfficerDAO->getLengthOfServiceLeft($tempOfficerDAO->stayInRegion($regiondoj), date('Y-m-d', time())))),
                $stay_at_cur_region,
                $stay_at_cur_station,
				$stay_in_other_regions,
                $option [0]->transfer
            );*/
			
			
			$data_arr = array(
                $l + 1,
                $officer_data->civilCode,
                $officer_data->batch,
                $officer_data->name,
                $tempPostingVO->getDescription(),
                $tempPostingVO->getSequence(),
                $cityname,
                $tempRegionDAO->getRegion($tempPostingVO->getRegionid())->getName(),
                //getFormattedDate($tempPostingVO->fromDate),
                getFormattedDate($regiondoj),
                $newPTDAO->getTotalStayCalculationOnRegionStation($currentReigonId, $stgPostingList, 'region'),
                $stay_at_cur_region,
                $stay_at_cur_station,
				$stay_in_other_regions,
                $option [0]->transfer
            );



            $opt = explode(',', $option [0]->options);
            $opt_text = explode(AppBase::SEPARATOR, $option [0]->options_text);
            $opt_def = explode(',', $option_detail->stations_or_regions_deffiecient);
            $opt_data_text = array();

            if ($option_detail->option_window_type == 2) {
                $opt_data = $tempRegionDAO->getRegion($opt [0])->getName();
            } else {
                $opt_data = $tempStationDAO->getCity($opt [0])->getName();
            }
            if ($opt_text [0] != '') {
                $opt_data_text [] = '1: [' . $opt_text [0] . '] ';
            }
            if (in_array($opt [0], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                $def = ' (Deficient) ';
                $bg = "background-color:yellow";
            } else {
                $def ='';
                $bg ='';
            }
            $data_arr [] = $opt_data.$def;

            if ($option_detail->option_window_type == 2) {
                $opt_data = $tempRegionDAO->getRegion($opt [1])->getName();
            } else {
                $opt_data = $tempStationDAO->getCity($opt [1])->getName();
            }
            if ($opt_text [1] != '') {
                $opt_data_text [] = '2: [' . $opt_text [1] . '] ';
            }
            if (in_array($opt [1], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                $def = ' (Deficient) ';
                $bg = "background-color:yellow";
            } else {
                $def ='';
                $bg ='';
            }
            $data_arr [] = $opt_data.$def;

            if ($option_detail->option_window_type == 2) {
                $opt_data = $tempRegionDAO->getRegion($opt [2])->getName();
            } else {
                $opt_data = $tempStationDAO->getCity($opt [2])->getName();
            }
            if ($opt_text [2] != '') {
                $opt_data_text [] = '3: [' . $opt_text [2] . '] ';
            }
            if (in_array($opt [2], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                $def = ' (Deficient) ';
                $bg = "background-color:yellow";
            } else {
                $def ='';
                $bg ='';
            }
            $data_arr [] = $opt_data.$def;

            if ($option_detail->option_window_type == 2) {
                $opt_data = $tempRegionDAO->getRegion($opt [3])->getName();
            } else {
                $opt_data = $tempStationDAO->getCity($opt [3])->getName();
            }
            if ($opt_text [3] != '') {
                $opt_data_text [] = '4: [' . $opt_text [3] . '] ';
            }
            if (in_array($opt [3], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                $def = ' (Deficient) ';
                $bg = "background-color:yellow";
            } else {
                $def ='';
                $bg ='';
            }
            $data_arr [] = $opt_data.$def;

            if ($option_detail->option_window_type == 2) {
                $opt_data = $tempRegionDAO->getRegion($opt [4])->getName();
            } else {
                $opt_data = $tempStationDAO->getCity($opt [4])->getName();
            }
            if ($opt_text [4] != '') {
                $opt_data_text [] = '5: [' . $opt_text [4] . '] ';
            }
            if (in_array($opt [4], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                $def = ' (Deficient) ';
                $bg = "background-color:yellow";
            } else {
                $def ='';
                $bg ='';
            }
            $data_arr [] = $opt_data.$def;

            if ($option_detail->option_window_type == 2) {
                $opt_data = $tempRegionDAO->getRegion($opt [5])->getName();
            } else {
                $opt_data = $tempStationDAO->getCity($opt [5])->getName();
            }
            if ($opt_text [5] != '') {
                $opt_data_text [] = '6: [' . $opt_text [5] . '] ';
            }
            if (in_array($opt [5], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                $def = ' (Deficient) ';
                $bg = "background-color:yellow";
            } else {
                $def ='';
                $bg ='';
            }
            $data_arr [] = $opt_data.$def;

            if ($option_detail->option_window_type == 2) {
                $opt_data = $tempRegionDAO->getRegion($opt [6])->getName();
            } else {
                $opt_data = $tempStationDAO->getCity($opt [6])->getName();
            }
            if ($opt_text [6] != '') {
                $opt_data_text [] = '7 [' . $opt_text [6] . '] ';
            }
            if (in_array($opt [6], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                $def = ' (Deficient) ';
                $bg = "background-color:yellow";
            } else {
                $def ='';
                $bg ='';
            }
            $data_arr [] = $opt_data.$def;


            $data_arr [] = implode("\n", $opt_data_text);
            $data_arr [] = $tempStateDAO->getState($option [0]->domicileState)->getName();

            if (!empty($option)) {
                if ($option [0]->authenticated == 1)
                    $data_arr [] = 'Yes';
                else
                    $data_arr [] = 'No';
            } else {
                $data_arr [] = '';
            }

            if ($officer_data->cca_status == 3) {
                $data_arr [] = 'CCA Approved';
            } else if ($officer_data->cca_status == 4) {
                $data_arr [] = 'CCA Rejected';
            } else {
                $data_arr [] = '';
            }

            $data_arr [] = ucwords(strtolower($tempOfficerDAO->getLengthOfServiceLeft($tempOfficerDAO->getRetirementDate($officer_data->officer_id)->getRetirementDate(), implode('-', array_reverse(explode('-', $retirement_data->retirement_date)))))) . '(' . implode('-', array_reverse(explode('-', $tempOfficerDAO->getRetirementDate($officer_data->officer_id)->getRetirementDate()))) . ')';
            $reason_val = explode(',', $option [0]->reasons);
            $res_result = array();

            foreach ($reason_val as $lres) {
                if ($lres == 1 && $option [0]->wslist != '')
                    $res_result [] = 'Working spouse - ' . $option [0]->wslist;
                if ($lres == 2 && $option [0]->medlist != '')
                    $res_result [] = 'Medical grounds - ' . $option [0]->medlist;
                if ($lres == 3 && $option [0]->edulist != '') {
                    $sub_res = explode(',', $option [0]->edulist);
                    $sub_res_arr = array();
                    if (in_array("Class X", $sub_res) && $option [0]->x1 != '')
                        $sub_res_arr [] = 'Class X (Academic Year ' . $option [0]->x1 . ')';
                    if (in_array("Class XII", $sub_res) && $option [0]->x2 != '')
                        $sub_res_arr [] = 'Class XII (Academic Year ' . $option [0]->x2 . ')';
                    $res_result [] = 'Education of children - ' . implode(',', $sub_res_arr);
                }
                if ($lres == 5)
                    $res_result [] = 'Others';
            }

            $data_arr [] = implode(' | ', $res_result);

            $spec = array();
            switch ($officer_data->option_status) {
                case 1 :
                    $spec [] = 'Unfilled';
                    break;
                case 2 :
                    $data_arr [] = 'Pending at CCA';
                    break;
                case 3 :
                    $data_arr [] = 'CCA Approved';
                    break;
                case 4 :
                    $data_arr [] = 'CCA Rejected';
                    break;
                case 5 :
                    $data_arr [] = 'DBC Printed';
                    break;
                case 6 :
                    $data_arr [] = 'Closed';
                    break;
            }

            if ($option [0]->spousespecification != '') {
                $spec [] = 'Working spouse: ' . $option [0]->spousespecification;
            }
            if ($option [0]->medicalspecification != '') {
                $spec [] = 'Medical grounds: ' . clean($option [0]->medicalspecification);
            }
            if ($option [0]->childrenspecification != '') {
                $spec [] = 'Education of children: ' . $option [0]->childrenspecification;
            }
            if ($option [0]->othersspecification != '') {
                $spec [] = 'Others: ' . $option [0]->othersspecification;
            }
            $data_arr [] = implode('. ', $spec);
            $data_arr [] = stripslashes($officer_data->cca_remark);

            if ($option [0]->modified_on != '') {
                $data_arr [] = date('d-m-Y', $option [0]->modified_on);
            } else if ($option [0]->created_on != '') {
                $data_arr [] = date('d-m-Y', $option [0]->created_on);
            } else {
                $data_arr [] = '';
            }

            $data_arr [] = $option_detail->option_no;
            $data_arr [] = stripslashes($officer_data->dbc_remark);
            $data [$l] = $data_arr;
            $l = $l + 1;
        }

        $objPHPExcel = new PHPExcel ();
        $objPHPExcel->getProperties()->setCreator("Cadre Management System");
        $objPHPExcel->getProperties()->setTitle("Option Report");
        $objPHPExcel->getProperties()->setSubject("Option report");
        $objPHPExcel->getProperties()->setCategory("Option Report file ");
        $objPHPExcel->setActiveSheetIndex(0);
        $objPHPExcel->getActiveSheet()->setCellValue('A1', 'Option Window Report');
        $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
        $objPHPExcel->setActiveSheetIndex(0)->mergeCells('A1:AD1');
        $objPHPExcel->getActiveSheet()->setCellValue('A2', 'S.No.');
        $objPHPExcel->getActiveSheet()->fromArray(array(
            $heading1
                ), NULL, 'B2');

        //$objPHPExcel->getActiveSheet()->fromArray($data, NULL, 'A3');
        // writing data in cell start
        $row = 3; // 1-based index
        $styleArray = array(
        'fill' => array(
            'type' => PHPExcel_Style_Fill::FILL_SOLID,
            'color' => array('rgb' => 'ffff00')
        )
          
        );
        $colArr=array('A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','AA','AB','AC','AD','AE','AF','AG','AH','AI');
        foreach ($data as $keyRow => $valueRow) {
            $col = 0;
            foreach($valueRow as $keyCol=>$valueCol) {
                if(preg_match('/(Deficient)/', $valueCol) && $keyCol>=13 && $keyCol<=20){
                    $objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col, $row, $valueCol);
                    $objPHPExcel->getActiveSheet()->getStyle($colArr[$col].$row)->applyFromArray($styleArray);
                } else {
                    $objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col, $row, $valueCol);
                }
                $col++;
            }
            $row++;
        }        
        // writing data in cell end
        
        $objPHPExcel->getActiveSheet()->getStyle('B')->getNumberFormat()->setFormatCode('00000');
        $objPHPExcel->getActiveSheet()->getStyle('I')->getNumberFormat()->setFormatCode('dd-mm-yyyy');
        $objPHPExcel->getActiveSheet()->getStyle('U')->getNumberFormat()->setFormatCode('dd-mm-yyyy');
        $objPHPExcel->getActiveSheet()->getStyle('AA')->getNumberFormat()->setFormatCode('dd-mm-yyyy');
        $objPHPExcel->getActiveSheet()->getStyle('B')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
        $objPHPExcel->getActiveSheet()->getStyle("A1:AD1")->getFont()->setBold(true);
        $objPHPExcel->getActiveSheet()->getStyle("A2:AD2")->getFont()->setBold(true);
        $objPHPExcel->getActiveSheet()->getStyle('A1:A' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('B1:B' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('C1:C' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('D1:D' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('E1:E' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('F1:F' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('G1:G' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('H1:H' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('I1:I' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('J1:J' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('K1:K' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('L1:L' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('M1:M' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('N1:N' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('O1:O' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('P1:P' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('Q1:Q' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('R1:R' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('S1:S' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('T1:T' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('U1:U' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('V1:V' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('W1:W' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('X1:X' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('Y1:Y' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('Z1:Z' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('AA1:AA' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('AB1:AB' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('AC1:AC' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('AD1:AD' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $sty_arr = array(
            'borders' => array(
                'allborders' => array(
                    'style' => PHPExcel_Style_Border::BORDER_THIN
                )
            )
        );
        $objPHPExcel->getActiveSheet()->getStyle('A1:' . $objPHPExcel->getActiveSheet()->getHighestColumn() . $objPHPExcel->getActiveSheet()->getHighestRow())->applyFromArray($sty_arr);

        $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
        $fileName = 'Option-Window-Report-' . date('d-m-Y,h:m:i', time()) . ".xlsx";

        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Content-Type: application/vnd.ms-excel');
        header('Cache-Control: max-age=0');
        header('Content-Type: application/force-download');
        header('Content-Type: application/octet-stream');
        header('Content-Type: application/download');
        header("Content-Disposition: attachment;filename=\"" . $fileName . "\"");
        header('Content-Transfer-Encoding: binary');
        $objWriter->save('php://output');

        exit();
    } else if ($_POST ['excel'] == "export") {

        if (isset($retirement_data)) {
            $los_heading = 'Length of Service (Ret. Date) (' . $retirement_data->retirement_date . ')';
        } else {
            $los_heading = 'Length of Service (Ret. Date)';
        }

        $heading_export = array(
            'Civil Code',
            'Name',
            'Post Desc.',
            'Station/Current CCA',
            'DOJ Current Region (' . date('d-m-Y', time()) . ')/Total Stay at Present Region',
            'Continuous Stay at Present Region',
            'Continuous Stay at Present Station',
			'Stay In other regions',
            'Trns. Req.?',
            'Options',
            'HomeState',
            $los_heading,
            'Reason',
            'Specification'
        );

        $l = 0;

        foreach ($officer_list as $officer_data) {
			/* comment by nishant on 01-03-2018
            $tempPostingVO = $tempPostingDAO->getOptionPostingListForOfficer($officer_data->officer_id);
			*/
			$tempPostingVO = $tempPostingDAO->getOptionPostingListForOfficerLastPosting($officer_data->officer_id);
			  
            $cityname = getColumnName($tempPostingVO->getCityid(), 'cities');
            $officercurrentregion = $tempStgPostingsDAO->getDueListCurrentPCity($officer_data->officer_id);
            //$regiondoj = $tempStgPostingsDAO->getLastPostingByRegion($officer_data->officer_id, $officercurrentregion);
            $option_detail = $tempOptionFlagDAO->getOption($officer_data->option_id);
            $option = $tempOptionFlagDAO->get_option_data($officer_data->assign_id, $officer_data->option_id);
            //22-02-2017
            $stgPostingList = $tempStgPostingsDAO->getPostingListForOfficer($officer_data->officer_id, "false");
            // new code
            $postingsOfficer = $tempStgPostingsDAO->getPostingListForMultipleOfficer (array($officer_data->officer_id), $showAdditionalCharge = '' );
            $stgPostingListNew = $postingsOfficer [$officer_data->officer_id];
            $regiondoj = $tempStgPostingsDAO->getLastJoiningDateByRegion ($officer_data->officer_id, $officercurrentregion,$stgPostingList, 'region', "Yes", "No");

            for ($cnt = 0; $cnt < count($stgPostingList); $cnt++) {
                $tempListPostingVO = $stgPostingList[$cnt];
                $islastposting = $tempListPostingVO->getislastPosting();
                if ($islastposting == 1 || $cnt == count($stgPostingList) - 1) {
                    $stationid = $tempListPostingVO->getCity();
                    $currentReigonId = $tempListPostingVO->getRegion();
                }
            }
            $stay_at_cur_region = $newPTDAO->continuousStayAtPresntStationPro($officer_data->officer_id, $currentReigonId, $stgPostingList, 'region', "Yes", "No");
            $stay_at_cur_station = $newPTDAO->continuousStayAtPresntStationPro($officer_data->officer_id, $stationid, $stgPostingList, 'city', "No", "No");
			$datum = $newPTDAO->getTotalStayOnRegionStationWise($stgPostingList, 'region');

			$stay_in_other_regions = '';
                                    foreach ($datum as $d) {
                                        $stay_in_other_regions .=  $d['RegionName'] . ' : ' . $d['Duration'] . "\n";
                                    }
            //22-02-2017 end
            /* $data_arr = array(
              $l + 1,
              $officer_data->getCivilCode(),
              $officer_data->getName(),
              $tempPostingVO->getDescription(),
              $cityname . " - \n" . $tempRegionDAO->getRegion($tempPostingVO->getRegionid())->getName(),
              getFormattedDate($regiondoj) . " - \n" . ucwords(strtolower($tempOfficerDAO->getLengthOfServiceLeft($tempOfficerDAO->stayInRegion($regiondoj), date('Y-m-d', time())))),
              $stay_at_cur_region,
              $stay_at_cur_station,
              $option [0]->transfer
              ); */
            $data_arr = array(
                $l + 1,
                $officer_data->civilCode,
                $officer_data->name,
                $tempPostingVO->getDescription(),
                $cityname . " - \n" . $tempRegionDAO->getRegion($tempPostingVO->getRegionid())->getName(),
                getFormattedDate($regiondoj) . " - \n" . $newPTDAO->getTotalStayCalculationOnRegionStation($currentReigonId, $stgPostingList, 'region'),
                $stay_at_cur_region,
                $stay_at_cur_station,
				$stay_in_other_regions,
                $option [0]->transfer
            );

            $opt = explode(',', $option [0]->options);
            $opt_text = explode(AppBase::SEPARATOR, $option [0]->options_text);
            $opt_def = explode(',', $option_detail->stations_or_regions_deffiecient);
            $op_arr = array();

            // $op_arr[] = 'Option 1';
            if (isset($opt[0]) && $opt [0] != '') {
                if ($option_detail->option_window_type == 2) {
                    $opt_data = "Option 1: " . $tempRegionDAO->getRegion($opt [0])->getName();
                } else {
                    $opt_data = "Option 1: " . $tempStationDAO->getCity($opt [0])->getName();
                }
                if ($opt_text [0] != '') {
                    $opt_data .= ' [' . $opt_text [0] . '] ';
                }
                if (in_array($opt [0], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                    $def = '<font color="red"> (Deficient) </font>';
                    $bg = "background-color:yellow";
                } else {
                    $def ='';
                    $bg ='';
                }
                $op_arr [] = $opt_data.$def;
            }

            // $op_arr[] = 'Option 2';
            if (isset($opt[1]) && $opt [1] != '') {
                if ($option_detail->option_window_type == 2) {
                    $opt_data = "Option 2: " . $tempRegionDAO->getRegion($opt [1])->getName();
                } else {
                    $opt_data = "Option 2: " . $tempStationDAO->getCity($opt [1])->getName();
                }
                if ($opt_text [1] != '') {
                    $opt_data .= ' [' . $opt_text [1] . '] ';
                }
                if (in_array($opt [1], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                    $def = '<font color="red"> (Deficient) </font>';
                    $bg = "background-color:yellow";
                } else {
                    $def ='';
                    $bg ='';
                }
                $op_arr [] = $opt_data.$def;
            }

            // $op_arr[] = 'Option 3';
            if (isset($opt[2]) && $opt [2] != '') {
                if ($option_detail->option_window_type == 2) {
                    $opt_data = "Option 3: " . $tempRegionDAO->getRegion($opt [2])->getName();
                } else {
                    $opt_data = "Option 3: " . $tempStationDAO->getCity($opt [2])->getName();
                }
                if ($opt_text [2] != '') {
                    $opt_data .= ' [' . $opt_text [2] . '] ';
                }
                if (in_array($opt [2], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                    $def = '<font color="red"> (Deficient) </font>';
                    $bg = "background-color:yellow";
                } else {
                    $def ='';
                    $bg ='';
                }
                $op_arr [] = $opt_data.$def;
            }

            // $op_arr[] = 'Option 4';
            if (isset($opt[3]) && $opt [3] != '') {
                if ($option_detail->option_window_type == 2) {
                    $opt_data = "Option 4: " . $tempRegionDAO->getRegion($opt [3])->getName();
                } else {
                    $opt_data = "Option 4: " . $tempStationDAO->getCity($opt [3])->getName();
                }
                if ($opt_text [3] != '') {
                    $opt_data .= ' [' . $opt_text [3] . '] ';
                }
                if (in_array($opt [3], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                    $def = '<font color="red"> (Deficient) </font>';
                    $bg = "background-color:yellow";
                } else {
                    $def ='';
                    $bg ='';
                }
                $op_arr [] = $opt_data.$def;
            }

            // $op_arr[] = 'Option 5';
            if (isset($opt[4]) && $opt [4] != '') {
                if ($option_detail->option_window_type == 2)
                    $opt_data = "Option 5: " . $tempRegionDAO->getRegion($opt [4])->getName();
                else
                    $opt_data = "Option 5: " . $tempStationDAO->getCity($opt [4])->getName();
                if ($opt_text [4] != '')
                    $opt_data .= ' [' . $opt_text [4] . '] ';
                if (in_array($opt [4], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                    $def = '<font color="red"> (Deficient) </font>';
                    $bg = "background-color:yellow";
                } else {
                    $def ='';
                    $bg ='';
                }
                $op_arr [] = $opt_data.$def;
            }

            $data_arr [] = implode("\n", $op_arr);
            $data_arr [] = $tempStateDAO->getState($option [0]->domicileState)->getName();
            $data_arr [] = ucwords(strtolower($tempOfficerDAO->getLengthOfServiceLeft($tempOfficerDAO->getRetirementDate($officer_data->officer_id)->getRetirementDate(), implode('-', array_reverse(explode('-', $retirement_data->retirement_date)))))) . '(' . implode('-', array_reverse(explode('-', $tempOfficerDAO->getRetirementDate($officer_data->officer_id)->getRetirementDate()))) . ')';

            // if($option_detail->option_window_type == 2) $opt_data = $tempRegionDAO->getRegion($opt[5])->getName();else $opt_data = $tempStationDAO->getCity($opt[5])->getName();
            // if($opt_text[5] != '') $opt_data .= ' ['.$opt_text[5].'] '; $data_arr[] = $opt_data;
            // if($option_detail->option_window_type == 2) $opt_data = $tempRegionDAO->getRegion($opt[6])->getName();else $opt_data = $tempStationDAO->getCity($opt[6])->getName();
            // if($opt_text[6] != '') $opt_data .= ' ['.$opt_text[6].'] '; $data_arr[] = $opt_data;
            // if($option_detail->option_window_type == 2) $data_arr[] = $tempRegionDAO->getRegion($opt[5])->getName();else $data_arr[] = $tempStationDAO->getCity($opt[5])->getName();
            // if($option_detail->option_window_type == 2) $data_arr[] = $tempRegionDAO->getRegion($opt[6])->getName();else $data_arr[] = $tempStationDAO->getCity($opt[6])->getName();
            // if(!empty($option)) { if($option[0]->authenticated == 1) $data_arr_val[] = 'Yes'; else $data_arr_val[] = 'No'; } else $data_arr_val[] = '';
            // if($officer_data->option_status == 3) $data_arr[] = 'CCA Approved'; else if($officer_data->option_status == 4) $data_arr[] = 'CCA Rejected'; else $data_arr[] = '';

            $reason_val = explode(',', $option [0]->reasons);

            $res_result = array();

            foreach ($reason_val as $lres) {
                if ($lres == 1 && $option [0]->wslist != '')
                    $res_result [] = 'Working spouse - ' . $option [0]->wslist;
                if ($lres == 2 && $option [0]->medlist != '')
                    $res_result [] = 'Medical grounds - ' . $option [0]->medlist;
                if ($lres == 3 && $option [0]->edulist != '') {
                    $sub_res = explode(',', $option [0]->edulist);
                    $sub_res_arr = array();
                    if (in_array("Class X", $sub_res) && $option [0]->x1 != '')
                        $sub_res_arr [] = 'Class X (Academic Year ' . $option [0]->x1 . ')';
                    if (in_array("Class XII", $sub_res) && $option [0]->x2 != '')
                        $sub_res_arr [] = 'Class XII (Academic Year ' . $option [0]->x2 . ')';
                    $res_result [] = 'Education of children - ' . implode(',', $sub_res_arr);
                }
                if ($lres == 5)
                    $res_result [] = 'Others';
            }

            $data_arr [] = utf8_encode(implode(' | ', $res_result));
            $objRichText = new PHPExcel_RichText ();

            if ($option [0]->spousespecification != '') {
                $objBold = $objRichText->createTextRun('Working spouse: ');
                $objBold->getFont()->setBold(true);
                $objRichText->createText(utf8_encode(addslashes($option [0]->spousespecification . "\n")));
            }

            if ($option [0]->medicalspecification != '') {
                $objBold = $objRichText->createTextRun('Medical grounds: ');
                $objBold->getFont()->setBold(true);
                $objRichText->createText(utf8_encode(addslashes($option [0]->medicalspecification . "\n")));
            }

            if ($option [0]->childrenspecification != '') {
                $objBold = $objRichText->createTextRun('Education of children: ');
                $objBold->getFont()->setBold(true);
                $objRichText->createText(utf8_encode(addslashes($option [0]->childrenspecification . "\n")));
            }

            if ($option [0]->othersspecification != '') {
                $objBold = $objRichText->createTextRun('Others: ');
                $objBold->getFont()->setBold(true);
                $objRichText->createText(utf8_encode(addslashes($option [0]->othersspecification)));
            }

            $data_arr [] = $objRichText;
            unset($objRichText);
            // $data[] = array_map( 'utf8_encode',$data_arr);
            $data [] = $data_arr;
            $l = $l + 1;
        }

        /* Print Excel */

        $objPHPExcel = new PHPExcel ();
        $objPHPExcel->getProperties()->setCreator("Cadre Management System");
        $objPHPExcel->getProperties()->setTitle("Option Report");
        $objPHPExcel->getProperties()->setSubject("Option report");
        $objPHPExcel->getProperties()->setCategory("Option Report file ");
        $objPHPExcel->setActiveSheetIndex(0);
        $objPHPExcel->getActiveSheet()->setCellValue('B4', 'S.No.');
        $objPHPExcel->getActiveSheet()->getStyle('C')->getNumberFormat()->setFormatCode('00000');
        $objPHPExcel->getActiveSheet()->fromArray(array(
            $heading_export
                ), NULL, 'C4');

        $objPHPExcel->getActiveSheet()->fromArray($data, NULL, 'B6');
        $objPHPExcel->getActiveSheet()->getStyle('I')->getNumberFormat()->setFormatCode('dd-mm-yyyy');
        $objPHPExcel->getActiveSheet()->getStyle('U')->getNumberFormat()->setFormatCode('dd-mm-yyyy');
        $objPHPExcel->getActiveSheet()->getStyle('AA')->getNumberFormat()->setFormatCode('dd-mm-yyyy');
        $objPHPExcel->getActiveSheet()->getStyle('C')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT)->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle("A4:AD4")->getFont()->setBold(true);

        // $objPHPExcel->getActiveSheet()->getStyle('A1')->applyFromArray($styleArray);
        $objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(3);
        $objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(4);
        $objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
        $objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(12);
        $objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(10);
        $objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(10);
        $objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(10);
        $objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(6);
        $objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(18);
        $objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(8);
        $objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(10);
        $objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(50);

        $objPHPExcel->setActiveSheetIndex(0)->mergeCells('B2:M2');
        $objPHPExcel->getActiveSheet()->setCellValue('B2', 'OPTION FORM REPORT');
        $styleArray = array(
            'font' => array(
                'bold' => true,
                'size' => 13
            ),
            'alignment' => array(
                'wrap' => true
            )
        );
        $objPHPExcel->getActiveSheet()->getStyle('B2')->applyFromArray($styleArray);
        $objPHPExcel->getActiveSheet()->getRowDimension('2')->setRowHeight(20);
        $objPHPExcel->getActiveSheet()->getStyle('B2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
        $objPHPExcel->getActiveSheet()->getStyle('A1:A' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('B1:B' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('C1:C' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('D1:D' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('E1:E' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('F1:F' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('G1:G' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('H1:H' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('I1:I' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('J1:J' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('K1:K' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('L1:L' . (count($data) + 6))->getAlignment()->setWrapText(true);
        $objPHPExcel->getActiveSheet()->getStyle('M1:M' . (count($data) + 6))->getAlignment()->setWrapText(true);

        $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
        $fileName = 'Option-Window-Report-' . date('d-m-Y,h:m:i', time()) . ".xlsx";

        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Content-Type: application/vnd.ms-excel');
        header('Cache-Control: max-age=0');
        header('Content-Type: application/force-download');
        header('Content-Type: application/octet-stream');
        header('Content-Type: application/download');
        header("Content-Disposition: attachment;filename=\"" . $fileName . "\"");
        header('Content-Transfer-Encoding: binary');
        $objWriter->save('php://output');
        exit();
    }
} else if ($_SERVER ['REQUEST_METHOD'] == "POST" && $_POST ['actionType'] == 'change') {

    extract($_POST);
    $opt_st = array();

    foreach ($_POST ['cb'] as $cb_val) {
        $opt_st [] = $tempOptionFlagDAO->getDbcRemarkAssignId($cb_val)->option_status;
    }

    if (count($_POST ['cb']) == 1) {
        if (isset($_POST ['cb'])) {
            $dbc_remark_val = addslashes($_POST ['dbc_remark_all_hidden']);
            $add_or_update = $_POST ['replace_existing_hidden'];
            foreach ($_POST ['cb'] as $assign_id) {
                $tempOptionFlagDAO->update_assign_option_status($assign_id, $_POST ['option_status_form_hidden']);
                $update = $tempOptionFlagDAO->update_dbc_remark($assign_id, $dbc_remark_val, $add_or_update);
            }
        }

        $msg = "Option status and remark updated successfully.";
    } else if (count(array_unique($opt_st)) == 1 && count($_POST ['cb']) > 1) {

        if (isset($_POST ['cb'])) {
            $dbc_remark_val = addslashes($_POST ['dbc_remark_all_hidden']);
            $add_or_update = $_POST ['replace_existing_hidden'];

            foreach ($_POST ['cb'] as $assign_id) {
                $tempOptionFlagDAO->update_assign_option_status($assign_id, $_POST ['option_status_form_hidden']);
                $update = $tempOptionFlagDAO->update_dbc_remark($assign_id, $dbc_remark_val, $add_or_update);
            }
        }
        $msg = "Option status and remarks updated successfully.";
    } else {
        $msg = "Error! Option status not same in selected records.";
    }

    $officer_list = $tempOptionFlagDAO->getOfficersListForReport($option_window_for, $option_window, $option_window_no, $option_status, $region, $rank, $transfer, $optionRegion, $city, $batch, $sort, $flagid, $duestatus, $reason, $sub_reason, $latest, $civil_code);
} else if ($_SERVER ['REQUEST_METHOD'] == "POST" && $_POST ['actionType'] == 'download') {

    if (isset($_POST ['cb'])) {
        foreach ($_POST ['cb'] as $assign_id) {
            $tempOptionFlagDAO->update_assign_option_status($assign_id, $_POST ['option_status']);
        }
    }
    $officer_list = $tempOptionFlagDAO->getOfficersListForReport($option_window_for, $option_window, $option_window_no, $option_status, $region, $rank, $transfer, $optionRegion, $city, $batch, $sort, $flagid, $duestatus, $reason, $sub_reason, $latest, $civil_code);
} else if ($_SERVER ['REQUEST_METHOD'] == "POST" && $_POST ['actionType'] == 'dbcremark') {

    extract($_POST);

    if (!empty($_POST ['dbc_remark_check']) && !empty($_POST ['dbc_remark'])) {
        $assign_arr = $_POST ['dbc_remark_check'];
        $dbc_arr = array_filter($_POST ['dbc_remark']);

        if (isset($dbc_arr) && isset($assign_arr)) {

            foreach ($assign_arr as $key => $assign_id) {

                $update = $tempOptionFlagDAO->update_dbc_remark($assign_id, $dbc_arr [$key]);
            }
        }
    }

    if (!empty($_POST ['cb']) && $_POST ['dbc_remark_all_hidden'] != '') {

        $assign_arr = $_POST ['cb'];
        $dbc_remark_val = addslashes($_POST ['dbc_remark_all_hidden']);
        $add_or_update = $_POST ['replace_existing_hidden'];

        if (isset($dbc_remark_val) && isset($assign_arr)) {

            foreach ($assign_arr as $key => $assign_id) {

                $update = $tempOptionFlagDAO->update_dbc_remark($assign_id, $dbc_remark_val, $add_or_update);
            }
            $msg = "DBC Remarks updated successfully.";
        }
    }

    $officer_list = $tempOptionFlagDAO->getOfficersListForReport($option_window_for, $option_window, $option_window_no, $option_status, $region, $rank, $transfer, $optionRegion, $city, $batch, $sort, $flagid, $duestatus, $reason, $sub_reason, $latest, $civil_code);
} else {

    // $officer_list = $tempOptionFlagDAO->getOfficersListForReport();
}
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <title>Cadre Management System</title>
        <link href="css/style.css" rel="stylesheet" type="text/css" />
        <style type="text/css">
            .surveform-main {
                width: 1000px;
                margin: 0 auto;
            }

            .surveform h2, h4 {
                text-align: center
            }

            .surveform p {
                text-align: justify;
                clear: both
            }

            .form-container {
                width: 500px;
                margin: 0 auto;
                clear: both
            }

            .form-container span {
                float: left;
                width: 500px;
                padding: 5px 0;
            }
        </style>
        <?php if (isset($msg)) { ?>
            <script type="text/javascript">
                alert("<?php echo $msg; ?>");
            </script>
        <?php } ?>
        <script src="js/jquery-1.9.1.js"></script>
        <!--<link rel="stylesheet" href="css/jquery-ui.css">-->
        <script src="js/jquery-ui.js"></script>
        <script type="text/javascript">
                $(document).ready(function () {
                    $('#retirement_date').datepicker({yearRange: '<?php echo date('Y'); ?>:' + <?php echo date('Y') + 20; ?>});
                    /* Change */
                    $('#optionRegion').change(function () {
                        if ($(this).val() == '-1') {
                            $('#r_opt_no').val('');
                            $('#city').removeAttr('disabled');
                            $('#s_opt_no').removeAttr('disabled');
                        } else {
                            $('#city').val('');
                            $('#s_opt_no').val('');
                            $('#city').attr('disabled', 'disabled');
                            $('#s_opt_no').attr('disabled', 'disabled');
                        }
                    });

                    $('#city').change(function () {
                        if ($(this).val() == '-1') {
                            $('#s_opt_no').val('');
                            $('#optionRegion').removeAttr('disabled');
                            $('#r_opt_no').removeAttr('disabled');
                        } else {
                            $('#optionRegion').val('');
                            $('#s_opt_no').val('');
                            $('#optionRegion').attr('disabled', 'disabled');
                            $('#r_opt_no').attr('disabled', 'disabled');
                        }
                    });

                    $('#r_opt_no').change(function () {
                        if ($('#optionRegion').val() == '-1') {
                            alert("Please select Opted-Option Region first.");
                            $(this).val('');
                        }
                    });

                    $('#s_opt_no').change(function () {
                        if ($('#city').val() == '-1') {
                            alert("Please select Opted-Option Station first.");
                            $(this).val('');
                        }
                    });

<?php if (isset($_POST['city']) && $_POST['city'] != '-1') { ?>$('#optionRegion').val('');
                        $('#r_opt_no').val('');
                        $('#optionRegion').attr('disabled', 'disabled');
                        $('#r_opt_no').attr('disabled', 'disabled');
<?php } ?>

<?php if (isset($_POST['optionRegion']) && $_POST['optionRegion'] != '-1') { ?>
                        $('#city').val('');
                        $('#s_opt_no').val('');
                        $('#city').attr('disabled', 'disabled');
                        $('#s_opt_no').attr('disabled', 'disabled');
<?php } ?>


                    /* End change */
                    $('.tempcheckbox').change(function () {

                        if ($(this).is(':checked'))
                        {
                            $(this).parent().find('textarea').removeAttr('style');
                            $(this).parent().find('textarea').removeAttr('disabled');
                            $(this).parent().find('textarea').removeClass('disabled');
                        } else
                        {
                            $(this).parent().find('textarea').attr('style', 'display:none');
                            $(this).parent().find('textarea').attr('disabled', 'disabled');
                            $(this).parent().find('textarea').addClass('disabled');
                        }

                    });

                    if ($('#option_window option:selected').val() != '') {
                        $('.surveform .quest h1 label').html($('#option_window option:selected').text());
                    }

                    /*$('#survey-form1').submit(function(){
                     if($('#option_window').val() == ''){
                     alert("Please select a option window.");
                     return false;
                     }
                     
                     });*/
                    /*$("#cb").change(function() {
                     if(this.checked) {
                     $('input[name="cb[]"]').each(function(){
                     $(this).attr( "checked", 'checked' );
                     });
                     }
                     else {
                     $('input[name="cb[]"]').each(function(){
                     $(this).removeAttr( "checked");
                     });
                     }
                     });*/
                    $("#cb").change(function () {
                        //var checkboxes = $(this).closest('assignform').find('');
                        if ($(this).is(':checked')) {
                            $('input[name="cb[]"]').click();
                        } else {
                            $('input[name="cb[]"]').click();//$('input[name="cb[]"]').removeAttr('checked');
                        }
                    });

                    $('#option_assign_status').change(function () {
                        if ($(this).val() == 2) {
                            $('#option_status').attr('disabled', 'disabled');
                        } else {
                            $('#option_status').removeAttr('disabled');
                        }
                    });

                    $('#option_status').change(function () {
                        if ($(this).val() != '') {
                            $('#option_assign_status').val(1);
                        } else {
                            $('#option_assign_status').val('');
                        }
                    });

                    $('#assignform').submit(function () {
                        var temp = '';
                        $('input[type="checkbox"]').each(function () {
                            temp += $(this).val();
                        });
                        //alert(temp);
                        //return false;
                    });

                    $('#change_option_status').click(function () {

                        if ($('#option_status_form').val() == '') {
                            alert('Please select a option status.');
                            $('#option_status_form').focus();
                            return false;
                        } else {
                            $('#AssignActionType').val('change');
                            $('#option_status_form_hidden').val($('#option_status_form').val());
                            $('#dbc_remark_all_hidden').val($('#dbc_remark_all').val());
                            if ($('#replace_existing').is(':checked')) {
                                $('#replace_existing_hidden').val('1');
                            } else {
                                $('#replace_existing_hidden').val('0');
                            }
                            $('#assignform').submit();
                        }
                    });

                    $('#download').click(function () {

                        $('#AssignActionType').val('download');
                        $('#assignform').submit();
                    });

                    $('#update_dbc_remark').click(function () {
                        if ($('#dbc_remark_all_add').val() == '') {
                            alert('Please enter dbc remarks.');
                        } else {
                            $('#AssignActionType').val('dbcremark');
                            $('#dbc_remark_all_hidden').val($('#dbc_remark_all_add').val());
                            if ($('#replace_existing_add').is(':checked')) {
                                $('#replace_existing_hidden').val('1');
                            } else {
                                $('#replace_existing_hidden').val('0');
                            }
                            $('#assignform').submit();

                        }
                    });

                    $('#download_as_excel').click(function () {

                        $('#actionType').val('search');
                        $('#excel').val('excel');
                        $('#survey-form1').submit();
                    });

                    $('#download_as_excel_export').click(function () {

                        $('#actionType').val('search');
                        $('#excel').val('export');
                        $('#survey-form1').submit();
                    });

                    $('#search').click(function () {

                        $('#actionType').val('search');
                        $('#excel').val('');
                        $('#survey-form1').submit();
                    });

                    $('#option_window').change(function () {

                        if ($(this).val() != '') {
                            $('.surveform .quest h1 label').html($('#option_window option:selected').text());
                        }
                        $('#option_window_no').val($(this).val());
                    });

                    $('#option_window_no').change(function () {
                        $('#option_window').val($(this).val());
                    });

<?php if ($_POST['reason'] == 1) { ?>
                        $('#wslist').show();
<?php } else { ?>
                        $('#wslist').hide();
<?php } ?>
<?php if ($_POST['reason'] == 2) { ?>
                        $('#medlist').show();
<?php } else { ?>
                        $('#medlist').hide();
<?php } ?>
<?php if ($_POST['reason'] == 3) { ?>
                        $('#edulist').show();
<?php } else { ?>
                        $('#edulist').hide();
<?php } ?>
                    $('#reason').change(function () {
                        if ($(this).val() == 1)
                            $('#wslist').show();
                        else
                            $('#wslist').hide();
                        if ($(this).val() == 2)
                            $('#medlist').show();
                        else
                            $('#medlist').hide();
                        if ($(this).val() == 3) {
                            $('#edulist').show();
                            $('#educationx').click(function () {
                                if ($(this).is(':checked')) {
                                    $(this).after('<select name="x1" class="list-menu" id="x1"><option value="">Academic year for X</option><option value="<?php echo (date('Y') - 2) . '-' . (date('Y') - 1); ?>"><?php echo (date('Y') - 2) . '-' . (date('Y') - 1); ?></option><option value="<?php echo (date('Y') - 1) . '-' . date('Y'); ?>"><?php echo (date('Y') - 1) . '-' . date('Y'); ?></option><option value="<?php echo date('Y') . '-' . (date('Y') + 1); ?>"><?php echo date('Y') . '-' . (date('Y') + 1); ?></option><option value="<?php echo (date('Y') + 1) . '-' . (date('Y') + 2); ?>"><?php echo (date('Y') + 1) . '-' . (date('Y') + 2); ?></option></select> ');
                                } else {
                                    $('#x1').remove();
                                }
                            });

                            $('#educationx2').click(function () {
                                if ($(this).is(':checked')) {
                                    $(this).after('<select name="x2" class="list-menu" id="x2"><option value="">Academic year for XII</option><option value="<?php echo (date('Y') - 2) . '-' . (date('Y') - 1); ?>"><?php echo (date('Y') - 2) . '-' . (date('Y') - 1); ?></option><option value="<?php echo (date('Y') - 1) . '-' . date('Y'); ?>"><?php echo (date('Y') - 1) . '-' . date('Y'); ?></option><option value="<?php echo date('Y') . '-' . (date('Y') + 1); ?>"><?php echo date('Y') . '-' . (date('Y') + 1); ?></option><option value="<?php echo (date('Y') + 1) . '-' . (date('Y') + 2); ?>"><?php echo (date('Y') + 1) . '-' . (date('Y') + 2); ?></option></select> ');
                                } else {
                                    $('#x2').remove();
                                }
                            });
                        } else
                            $('#edulist').hide();
                    });
                });
        </script>
        <?php
        if (isset($_POST) && $_POST ['x1']) {
            ?>
            <script type="text/javascript">
                $(document).ready(function () {
                    $('#educationx').after('<select name="x1" class="list-menu" id="x1"><option value="">Academic year for X</option><option value="<?php echo (date('Y') - 2) . '-' . (date('Y') - 1); ?>"><?php echo (date('Y') - 2) . '-' . (date('Y') - 1); ?></option><option value="<?php echo (date('Y') - 1) . '-' . date('Y'); ?>"><?php echo (date('Y') - 1) . '-' . date('Y'); ?></option><option value="<?php echo date('Y') . '-' . (date('Y') + 1); ?>"><?php echo date('Y') . '-' . (date('Y') + 1); ?></option><option value="<?php echo (date('Y') + 1) . '-' . (date('Y') + 2); ?>"><?php echo (date('Y') + 1) . '-' . (date('Y') + 2); ?></option></select> ');
                    $('#x1').val('<?php echo $_POST['x1']; ?>');
                });
            </script>
        <?php } ?>
        <?php if (isset($_POST) && $_POST['x2']) { ?>
            <script type="text/javascript">
                $(document).ready(function () {
                    $('#educationx2').after('<select name="x2" class="list-menu" id="x2"><option value="">Academic year for XII</option><option value="<?php echo (date('Y') - 2) . '-' . (date('Y') - 1); ?>"><?php echo (date('Y') - 2) . '-' . (date('Y') - 1); ?></option><option value="<?php echo (date('Y') - 1) . '-' . date('Y'); ?>"><?php echo (date('Y') - 1) . '-' . date('Y'); ?></option><option value="<?php echo date('Y') . '-' . (date('Y') + 1); ?>"><?php echo date('Y') . '-' . (date('Y') + 1); ?></option><option value="<?php echo (date('Y') + 1) . '-' . (date('Y') + 2); ?>"><?php echo (date('Y') + 1) . '-' . (date('Y') + 2); ?></option></select> ');
                    $('#x2').val('<?php echo $_POST['x2']; ?>');
                });
            </script>
        <?php } ?>
    </head>
    <body>
        <?php
        include ('includes/header.php');
        include ('includes/topnav.php');
        $href = "dashboard.php";
        ?>
        <div class="optionwindow-report">
            <h1>
                <a href="<?php echo $href; ?>">Option Window</a> &rsaquo; Option Window Report
            </h1>
            <div class="questformdesign1">
                <ul class="questform1">
                    <li class="tabs-bttn-unselectd"><a href="manage-option-window.php">Manage Option Window</a></li>
                    <li class="tabs-bttn-unselectd"><a href="add-new-option.php">Add Option</a></li>
                    <li class="tabs-bttn-unselectd"><a href="assign-option-window.php">Assign Officers to Option</a></li>
                    <li class="tabs-bttn-selectd">Option Window Report</li>
                </ul>
                <div class="optionform-main" id="window-report">
                    <div class="optionform">
                        <div class="quest">
                            <div class="optionform1">
                                <form name="survey-form1" id="survey-form1"
                                      action="<?php echo $_SERVER["PHP_SELF"]; ?>" method="post">
                                    <input type="hidden" name="actionType" id="actionType"
                                           value="search" /> <input type="hidden" name="option_id"
                                           class="option_id" id="option_id"
                                           value="<?php echo $_GET['id']; ?>" /> <input type="hidden"
                                           name="excel" class="excel" id="excel"
                                           value="<?php if (isset($_POST['excel'])) echo ''; ?>" />
                                    <ul>
                                        <li><label>Option Window Title</label> <select
                                                name="option_window" id="option_window" class="list-menu">
                                                <option value="">Please Select</option>
                                                <?php
                                                if (isset($_POST ['option_window'])) {
                                                    $opt_win = $_POST ['option_window'];
                                                } else if (isset($_GET ['option_id'])) {
                                                    $opt_win = $_GET ['option_id'];
                                                } else if (isset($_POST ['option_id'])) {
                                                    $opt_win = $_POST ['option_id'];
                                                }
                                                ?>
                                                <?php
                                                foreach ($option_window_list as $key => $val) {
                                                    echo '<option value="' . $val->option_id . '"';
                                                    if ($val->option_id == $opt_win) {
                                                        echo 'selected="selected"';
                                                    }
                                                    echo '>' . $val->option_title . '</option>';
                                                }
                                                ?>
                                            </select></li>
                                        <li><label>Option Window No</label> <select
                                                name="option_window_no" id="option_window_no"
                                                class="list-menu">
                                                <option value="">Please Select</option>
                                                <?php
                                                if (isset($_POST ['option_window'])) {
                                                    $opt_win = $_POST ['option_window'];
                                                } else if (isset($_GET ['option_id'])) {
                                                    $opt_win = $_GET ['option_id'];
                                                } else if (isset($_POST ['option_id'])) {
                                                    $opt_win = $_POST ['option_id'];
                                                }
                                                ?>
                                                <?php
                                                foreach ($option_window_list as $key => $val) {
                                                    echo '<option value="' . $val->option_id . '"';
                                                    if ($val->option_id == $opt_win) {
                                                        echo 'selected="selected"';
                                                    }
                                                    echo '>' . $val->option_no . '</option>';
                                                }
                                                ?>
                                            </select></li>
                                        <li><label>Option Window For</label> <select
                                                name="option_window_for" id="option_window_for"
                                                class="list-menu">
                                                <option value="">Please Select</option>
                                                <?php
                                                foreach ($option_for as $key => $val) {
                                                    echo '<option value="' . $key . '"';
                                                    if ($key == $_POST ['option_window_for']) {
                                                        echo 'selected="selected"';
                                                    }
                                                    echo '>' . $val . '</option>';
                                                }
                                                ?>
                                            </select></li>
                                        <li><label>Option Status</label> 
                                            <select id="option_status" name="option_status" class="list-menu"   <?php
                                            if ($option_assign_status == 2) {
                                                echo 'disabled="disabled"';
                                            }
                                            ?>>
                                                <option value="">Please Select</option>
                                                <?php
                                                foreach ($option_status_arr as $key => $val) {
                                                    echo '<option value="' . $key . '"';
                                                    if ($key == $_POST ['option_status']) {
                                                        echo 'selected="selected"';
                                                    }
                                                    echo '>' . $val . '</option>';
                                                }
                                                ?>
                                            </select></li>
                                        <li><label>Rank</label>
                                            <?php echo Dropdown::getRankList("list-menu", $_POST ['rank'], ""); ?> </li>
                                        <li><label>Batch</label> <select name="batch" id="batch" class="list-menu">
                                                <option value="">Please Select</option>
                                                <?php
                                                for ($i = date('Y'); $i > date('Y') - 60; $i --) {
                                                    echo '<option value="' . $i . '"';
                                                    if ($i == $_POST ['batch']) {
                                                        echo 'selected="selected"';
                                                    }
                                                    echo '>' . $i . '</option>';
                                                }
                                                ?>
                                            </select></li>
                                        <li><label>Region</label>
                                            <?php echo Dropdown::getOptionRegionList("list-menu-option-multiple-general", 'region', $_POST['region']); ?> </li>
                                        <li><label>Transfer Request?</label>
                                            <?php echo Dropdown::getTransferListForIo("list-menu", $_POST['transfer']); ?> </li>
                                        <li><label>Opted-Option Region:</label>
                                            <?php echo Dropdown::getRegionListforreportoption('optionRegion', 'list-menu-option-multiple-general', $_POST['optionRegion']); ?> </li>
                                        <li><label>Option No:</label> <select name="r_opt_no"  id="r_opt_no" class="list-menu">
                                                <option value="">Please select</option>
                                                <?php for ($i = 1; $i < 8; $i ++) { ?> 
                                                    <option value="<?php echo $i; ?>"
                                                            <?php if (isset($r_opt_no) && $r_opt_no == $i) echo 'selected="selected"'; ?>><?php echo $i; ?></option>
                                                        <?php } ?>
                                            </select></li>
                                        <li><label>Opted-Option City</label>
                                            <?php echo Dropdown::getAjaxCityListOption('list-menu-option-multiple-general', $_POST['city']); ?> </li>
                                        <li><label>Option No:</label> <select name="s_opt_no" id="s_opt_no" class="list-menu">
                                                <option value="">Please select</option>
                                                <?php for ($i = 1; $i < 8; $i ++) { ?> 
                                                    <option value="<?php echo $i; ?>"
                                                            <?php if (isset($s_opt_no) && $s_opt_no == $i) echo 'selected="selected"'; ?>><?php echo $i; ?></option>
                                                        <?php } ?>
                                            </select></li>
                                        <li><label>Option For Flagged Officer</label>
                                            <?php echo Dropdown::getFlagIdList("list-menu", $_POST['flagid']); ?> </li>
                                        <li><label>Due Status</label>
                                            <?php echo Dropdown::getAllDueListWithBlankOption("list-menu-fxd", $_POST['duestatus']); ?> </li>
                                        <li><label>Reason</label> <select name="reason" id="reason" class="list-menu">
                                                <option value="">Please select</option>
                                                <?php foreach ($reason_arr as $key => $val) { ?>
                                                    <option value="<?php echo $key; ?>"
                                                            <?php if ($key == $reason) echo 'selected="selected"'; ?>><?php echo $val; ?></option>
                                                        <?php } ?>
                                            </select></li>
                                        <li>
                                            <?php
                                            if (isset($_POST ['wslist']))
                                                echo Dropdown::getWSList('list-menu-option-multiple-general', implode(',', $_POST ['wslist']));
                                            else
                                                echo Dropdown::getWSList('list-menu-option-multiple-general', '');

                                            if (isset($_POST ['medlist']))
                                                echo Dropdown::getMedicalList('list-menu-option-multiple-general', implode(',', $_POST ['medlist']));
                                            else
                                                echo Dropdown::getMedicalList('list-menu-option-multiple-general', '');

                                            if (isset($_POST ['edulist']))
                                                echo Dropdown::getEducationList('list-menu-option-multiple-general', implode(',', $_POST ['edulist']));
                                            else
                                                echo Dropdown::getEducationList('list-menu-option-multiple-general', '');
                                            ?>
                                        </li>
										<li><label>Civil Code</label> <span>Comma Seperated</span>
										<!--input type="text" id="civil_code" value="<?php //echo $_POST['civil_code']; ?>" 
                                                                             name="civil_code" class="text-field"></li-->
																			
                        <textarea name="civil_code" id="civil_code" class="text-area"><?php if (isset($_POST['civil_code'])) echo $_POST['civil_code']; ?></textarea>
                                        <li><label>Latest Option form</label> 
										<input type="checkbox" name="latest" id="latest" value="1"
                                                                    <?php if ($latest == 1) echo 'checked="checked"'; ?> /></li>
                                        <li><label>Retirement Calculation Date</label>
                                            <?php if (isset($retirement_data)) { ?><input type="hidden" name="redit_id" id="redit_id"
                                                       value="<?php echo $retirement_data->id; ?>" /><?php } ?>
                                            <link rel="stylesheet" href="css/ui.datepicker.css" type="text/css" media="screen" title="Flora (Default)">
                                                <script src="js/ui.datepicker.js"></script>
                                                <input type="text" id="retirement_date"
                                                       name="retirement_date" class="text-field"
                                                       value="<?php if (isset($retirement_data)) echo $retirement_data->retirement_date; ?>" /></li>
                                    </ul>
                                    <ul class="buttons-strip">
                                        <li class="buttonbar"><input type="image"
                                                                     src="gifs/search-button-orange.gif" name="search" id="search"
                                                                     value="Search" /> <a
                                                                     href="<?php echo $_SERVER['PHP_SELF']; ?>"><img
                                                    src="gifs/reset-button.gif" border="0" hspace="5" /></a></li>
                                        <!--<li class="buttonbar">
                                                                        <a href="<?php echo $href; ?>">Assign to all Station Ranks</a> | 
                                                                        <a href="<?php echo $href; ?>">Assign to all region ranks</a>
                                                                        
                                                                </li>-->
                                    </ul>
                                </form>
                            </div>
                            <div class="resultset-div">
                                <div class="rocord-count">
                                    <?php if (isset($officer_list)) { ?>
                                        <?php echo ' Number of record: ' . count($officer_list); ?>
                                    <?php } ?>
                                </div>
                                <form name="assignform" id="assignform"
                                      action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post">
                                          <?php
                                          if ($_POST ['option_window'] != '')
                                              $option_id_val = $_POST ['option_window'];
                                          else if ($_POST ['option_window_no'] != '')
                                              $option_id_val = $_POST ['option_window_no'];
                                          ?>
                                    <input type="hidden" value="" id="AssignActionType"
                                           name="actionType" /> <input type="hidden" value=""
                                           id="dbc_remark_all_hidden" name="dbc_remark_all_hidden" /> <input
                                           type="hidden" value="" id="option_status_form_hidden"
                                           name="option_status_form_hidden" /> <input type="hidden"
                                           value="" id="replace_existing_hidden"
                                           name="replace_existing_hidden" /> <input type="hidden"
                                           value="<?php echo $_POST['option_window']; ?>"
                                           name="option_window" /> <input type="hidden"
                                           value="<?php echo $_POST['option_window_for']; ?>"
                                           name="option_window_for" /> <input type="hidden"
                                           value="<?php echo $_POST['option_status']; ?>"
                                           name="option_status" /> <input type="hidden"
                                           value="<?php echo $_POST['rank']; ?>" name="rank" /> <input
                                           type="hidden" value="<?php echo $_POST['batch']; ?>"
                                           name="batch" /> <input type="hidden"
                                           value="<?php echo $_POST['region']; ?>" name="region" /> <input
                                           type="hidden" value="<?php echo $_POST['transfer']; ?>"
                                           name="transfer" /> <input type="hidden"
                                           value="<?php echo $_POST['optionRegion']; ?>"
                                           name="optionRegion" /> <input type="hidden"
                                           value="<?php echo $_POST['r_opt_no']; ?>" name="r_opt_no" /> <input
                                           type="hidden" value="<?php echo $_POST['city']; ?>" name="city" />
                                    <input type="hidden" value="<?php echo $_POST['s_opt_no']; ?>"
                                           name="s_opt_no" /> <input type="hidden"
                                           value="<?php echo $_POST['flagid']; ?>" name="flagid" /> <input
                                           type="hidden" value="<?php echo $_POST['duestatus']; ?>"
                                           name="duestatus" /> <input type="hidden"
                                           value="<?php echo $_POST['reason']; ?>" name="reason" /> <input
                                           type="hidden" value="<?php echo $_POST['civil_code']; ?>"
                                           name="civil_code" /> <input type="hidden"
                                           value="<?php echo $_POST['latest']; ?>" name="latest" /> <input
                                           type="hidden" value="<?php echo $option_id_val; ?>"
                                           id="option_window_form" name="option_window">
                                        <div class="reportdiv">

                                            <table class="optionreport-data" cellspacing="0"
                                                   cellpadding="0" border="0">
                                                       <?php if (!empty($officer_list)) { ?>
                                                    <tr>
                                                        <th>S.No.</th>
                                                        <th><input type=checkbox value="" name="<?php echo 'cb'; ?>" id="<?php echo 'cb'; ?>" /></th>
                                                        <th>Civil Code</th>
                                                        <th>Batch</th>
                                                        <th>Name</th>
                                                        <th>Post Desc.</th>
                                                        <th>Post Code Sequence</th>
                                                    </tr>            
                                                    <?php $l = 0; ?>
                                                    <?php
                                                    foreach ($officer_list as $officer_data) {
//                                                        echo "<pre>"; print_r($officer_data); 
                                                      
                                                        $tempPostingVO = $tempPostingDAO->getOptionPostingListForOfficer($officer_data->officer_id);
                                                        $officercurrentregion = $tempPostingVO->regionid;
                                                        $regiondoj = $tempPostingVO->fromDate;
//                                                          echo "fhfghfgh";
//                                                         print_r($tempPostingVO);
//                                                        die;
                                                        $option_detail = $tempOptionFlagDAO->getOption($officer_data->option_id);
                                                        $option = $tempOptionFlagDAO->get_option_data($officer_data->assign_id, $officer_data->option_id);
                                                        $stgPostingList = $tempStgPostingsDAO->getPostingListForOfficer($officer_data->officer_id, "false");
                                                        // new code
                                                        $postingsOfficer = $tempStgPostingsDAO->getPostingListForMultipleOfficer (array($officer_data->officer_id), $showAdditionalCharge = '' );
                                                        $stgPostingListNew = $postingsOfficer [$officer_data->officer_id];
                                                        $regiondojNew = $tempStgPostingsDAO->getLastJoiningDateByRegion ($officer_data->officer_id, $officercurrentregion,$stgPostingListNew, 'region', "Yes", "No");                                                        
//                                                        $stgPostingList = $tempStgPostingsDAO->getPostingListForOfficerForOptionWindow($officer_data->officer_id, "false");

                                                        
                                                        $stay_at_cur_region = $newPTDAO->continuousStayAtPresntStationProOptionWindowReport($officer_data->officer_id, $tempPostingVO->regionid, $postingList[$officer_data->officer_id], 'region', "Yes", "No");
                                                        $stay_at_cur_station = $newPTDAO->continuousStayAtPresntStationProOptionWindowReport($officer_data->officer_id, $tempPostingVO->cityid, $postingList[$officer_data->officer_id], 'city', "No", "No");
//                                                        $stay_at_cur_region = $newPTDAO->continuousStayAtPresntStationPro($officer_data->officer_id, $tempPostingVO->regionid, $postingList[$officer_data->officer_id], 'region', "Yes", "No");
//                                                        $stay_at_cur_station = $newPTDAO->continuousStayAtPresntStationPro($officer_data->officer_id, $tempPostingVO->cityid, $postingList[$officer_data->officer_id], 'city', "No", "No");


//22-02-2017 end
                                                        ?>                   
                                                        <tr>
                                                            <td><strong><?php echo $l + 1; ?></strong></td>
                                                            <td><input type="checkbox"  value="<?php echo $officer_data->assign_id; ?>"
                                                                       name="<?php echo 'cb[]'; ?>"
                                                                       id="<?php echo 'cb' . $officer_data->assign_id; ?>" /></td>
                                                            <td><?php echo $officer_data->civilCode; ?></td>
                                                            <td><?php echo $officer_data->batch; ?></td>
                                                            <td><?php echo $officer_data->name; ?></td>
                                                            <td><?php echo $tempPostingVO->description; ?></td>
                                                            <td><?php echo $tempPostingVO->sequence; ?></td>

                                                        </tr>
                                                        <tr>
                                                            <th>Station</th>
                                                            <th>Current CCA</th>
                                                            <th>DOJ Current Region (<?php echo date('d-m-Y', time()); ?>)</th>
                                                            <th>Stay at Present Region</th>
                                                            <th>Continuous Stay at Present Region </th>
                                                            <th>Continuous Stay at Present Station </th>
                                                            <th>Stay In other regions</th>
                                                        </tr>
                                                        <tr>
                                                            <td><?php echo $tempPostingVO->cityname; ?></td>
                                                            <td><?php echo $tempPostingVO->regionname; ?></td>
                                                            <td><?php echo date('d-m-Y', strtotime($regiondojNew)); ?></td>
                                                            <td><?php echo ucwords(strtolower($tempOfficerDAO->getLengthOfServiceLeft($tempOfficerDAO->stayInRegion($regiondoj), date('Y-m-d', time())))); ?></td>
                                                            <td><?php echo $stay_at_cur_region; ?></td>
                                                            <td><?php echo $stay_at_cur_station; ?></td>
                                                            <td> <?php
															//$newPTDAO->continuousStayAtPresntStationProOptionWindowReport($officer_data->officer_id, $tempPostingVO->cityid, $postingList[$officer_data->officer_id], 'city', "No", "No");
																$datum = $newPTDAO->getTotalStayOnRegionStationWise($stgPostingList, 'region');
																foreach ($datum as $d) {
																	echo '<b>' . $d['RegionName'] . '</b> : ' . $d['Duration'] . '<br/>';
																}
																?></td>
                                                        </tr>
                                                        <tr>
                                                            <th width="60">Option 1</th>
                                                            <th width="60">Option 2</th>
                                                            <th width="60">Option 3</th>
                                                            <th width="60">Option 4</th>
                                                            <th width="60">Option 5</th>
                                                            <th width="60">Option 6</th>
                                                            <th width="60">Option 7</th>
                                                        </tr>
                                                        <tr>
                                                            <?php
                                                            $opt = explode(',', $option[0]->options);
                                                            $opt_text = explode(AppBase::SEPARATOR, $option[0]->options_text);
                                                            $opt_def = explode(',', $option_detail->stations_or_regions_deffiecient);
                                                            ?>
                                                            <?php 
                                                            if (in_array($opt [0], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                                                                $def = '<font color="red"> (Deficient) </font>';
                                                                $bg = "background-color:yellow";
                                                            } else {
                                                                $def ='';
                                                                $bg ='';
                                                            }
                                                            ?>
                                                            <td style="<?php echo $bg; ?>"><?php
                                                                if ($option_detail->option_window_type == 2)
                                                                    $opt_data = $tempRegionDAO->getRegion($opt [0])->getName();
                                                                else
                                                                    $opt_data = $tempStationDAO->getCity($opt [0])->getName();
                                                                if ($opt_text [0] != '')
                                                                    $opt_data .= ' [' . $opt_text [0] . '] ';
                                                                echo $opt_data.$def;
                                                                ?></td>
                                                            <?php 
                                                            if (in_array($opt [1], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                                                                $def = '<font color="red"> (Deficient) </font>';
                                                                $bg = "background-color:yellow";
                                                            } else {
                                                                $def ='';
                                                                $bg ='';
                                                            }
                                                            ?>
                                                            <td style="<?php echo $bg; ?>"><?php
                                                                if ($option_detail->option_window_type == 2)
                                                                    $opt_data = $tempRegionDAO->getRegion($opt [1])->getName();
                                                                else
                                                                    $opt_data = $tempStationDAO->getCity($opt [1])->getName();
                                                                if ($opt_text [1] != '')
                                                                    $opt_data .= ' [' . $opt_text [1] . '] ';
                                                                echo $opt_data.$def;
                                                                ?></td>
                                                            <?php 
                                                            if (in_array($opt [2], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient) ) {
                                                                $def = '<font color="red"> (Deficient) </font>';
                                                                $bg = "background-color:yellow";
                                                            } else {
                                                                $def ='';
                                                                $bg ='';
                                                            }
                                                            ?>
                                                            <td style="<?php echo $bg; ?>"><?php
                                                                if ($option_detail->option_window_type == 2)
                                                                    $opt_data = $tempRegionDAO->getRegion($opt [2])->getName();
                                                                else
                                                                    $opt_data = $tempStationDAO->getCity($opt [2])->getName();
                                                                if ($opt_text [2] != '')
                                                                    $opt_data .= ' [' . $opt_text [2] . '] ';
                                                                echo $opt_data.$def;
                                                                ?></td>
                                                            <?php 
                                                            if (in_array($opt [3], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                                                                $def = '<font color="red"> (Deficient) </font>';
                                                                $bg = "background-color:yellow";
                                                            } else {
                                                                $def ='';
                                                                $bg ='';
                                                            }
                                                            ?>
                                                            <td style="<?php echo $bg; ?>"><?php
                                                                if ($option_detail->option_window_type == 2)
                                                                    $opt_data = $tempRegionDAO->getRegion($opt [3])->getName();
                                                                else
                                                                    $opt_data = $tempStationDAO->getCity($opt [3])->getName();
                                                                if ($opt_text [3] != '')
                                                                    $opt_data .= ' [' . $opt_text [3] . '] ';
                                                                echo $opt_data.$def;
                                                                ?></td>
                                                            <?php 
                                                            if (in_array($opt [4], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                                                                $def = '<font color="red"> (Deficient) </font>';
                                                                $bg = "background-color:yellow";
                                                            } else {
                                                                $def ='';
                                                                $bg ='';
                                                            }
                                                            ?>
                                                            <td style="<?php echo $bg; ?>"><?php
                                                                if ($option_detail->option_window_type == 2)
                                                                    $opt_data = $tempRegionDAO->getRegion($opt [4])->getName();
                                                                else
                                                                    $opt_data = $tempStationDAO->getCity($opt [4])->getName();
                                                                if ($opt_text [4] != '')
                                                                    $opt_data .= ' [' . $opt_text [4] . '] ';
                                                                echo $opt_data.$def;
                                                                ?></td>
                                                            <?php 
                                                            if (in_array($opt [5], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                                                                $def = '<font color="red"> (Deficient) </font>';
                                                                $bg = "background-color:yellow";
                                                            } else {
                                                                $def ='';
                                                                $bg ='';
                                                            }
                                                            ?>
                                                            <td style="<?php echo $bg; ?>"><?php
                                                                if ($option_detail->option_window_type == 2)
                                                                    $opt_data = $tempRegionDAO->getRegion($opt [5])->getName();
                                                                else
                                                                    $opt_data = $tempStationDAO->getCity($opt [5])->getName();
                                                                if ($opt_text [5] != '')
                                                                    $opt_data .= ' [' . $opt_text [5] . '] ';
                                                                echo $opt_data.$def;
                                                                ?></td>
                                                            <?php 
                                                            if (in_array($opt [6], $opt_def) && !empty($option_detail->stations_or_regions_deffiecient)) {
                                                                $def = '<font color="red"> (Deficient) </font>';
                                                                $bg = "background-color:yellow";
                                                            } else {
                                                                $def ='';
                                                                $bg ='';
                                                            }
                                                            ?>
                                                            <td style="<?php echo $bg; ?>"><?php
                                                                if ($option_detail->option_window_type == 2)
                                                                    $opt_data = $tempRegionDAO->getRegion($opt [6])->getName();
                                                                else
                                                                    $opt_data = $tempStationDAO->getCity($opt [6])->getName();
                                                                if ($opt_text [6] != '')
                                                                    $opt_data .= ' [' . $opt_text [6] . '] ';
                                                                echo $opt_data.$def;
                                                                ?></td>

                                                        </tr>
                                                        <tr>
                                                            <th>Trns. Req.?</th>
															<th >HomeState</th>
                                                            <th colspan="2">Authenticated</th>
                                                            <th colspan="2">CCA Authentication</th>
                                                            <th><?php
                                                                if (isset($retirement_data))
                                                                    echo 'Length of Service (Ret. Date) (' . $retirement_data->retirement_date . ')';
                                                                else
                                                                    echo 'Length of Service (Ret. Date)';
                                                                ?>
                                                            </th>
                                                        </tr>
                                                        <tr>
														 <td><?php echo $option[0]->transfer; ?></td>
                                                            <td ><?php echo $tempStateDAO->getState($option[0]->domicileState)->getName(); ?></td>
                                                            <td colspan="2" class="authenticated"><?php
                                                                if (!empty($option)) {
                                                                    if ($option[0]->authenticated == 1)
                                                                        echo 'Yes';
                                                                    else {
                                                                        echo 'No';
                                                                        ?>
                                                                        <a href="uploads/prooffoption/<?php echo $option[0]->filename; ?>"
                                                                           target="_blank"><?php echo $option[0]->filename; ?></a>
                                                                           <?php
                                                                       }
                                                                   }
                                                                   ?></td>
                                                            <td colspan="2"><?php
                                                                if ($officer_data->cca_status == 3)
                                                                    echo 'CCA Approved';
                                                                else if ($officer_data->cca_status == 4)
                                                                    echo 'CCA Rejected';
                                                                ?></td>
                                                            <td><?php echo ucwords(strtolower($tempOfficerDAO->getLengthOfServiceLeft($tempOfficerDAO->getRetirementDate($officer_data->officer_id)->getRetirementDate(), implode('-', array_reverse(explode('-', $retirement_data->retirement_date)))))) . '(' . implode('-', array_reverse(explode('-', $tempOfficerDAO->getRetirementDate($officer_data->officer_id)->getRetirementDate()))) . ')'; ?></td>

                                                        </tr>
                                                        <tr>
                                                            <th colspan="2">Reason</th>
                                                            <th>Option Status</th>
                                                            <th>Option Filled Date</th>
                                                            <th colspan="2">Option Window No</th>
                                                            <th>DBC Remarks</th>
                                                        </tr>
                                                        <tr>
                                                            <td class="reason" colspan="2">
                                                                <?php $reason_val = explode(',', $option[0]->reasons); ?>
                                                                <?php
                                                                $res_result = array();
                                                                foreach ($reason_val as $lres) {
                                                                    if ($lres == 1 && $option [0]->wslist != '')
                                                                        $res_result [] = 'Working spouse - ' . $option [0]->wslist;
                                                                    if ($lres == 2 && $option [0]->medlist != '')
                                                                        $res_result [] = 'Medical grounds - ' . $option [0]->medlist;
                                                                    if ($lres == 3 && $option [0]->edulist != '') {
                                                                        $sub_res = explode(',', $option [0]->edulist);
                                                                        $sub_res_arr = array();
                                                                        if (in_array("Class X", $sub_res) && $option [0]->x1 != '')
                                                                            $sub_res_arr [] = 'Class X (Academic Year ' . $option [0]->x1 . ')';
                                                                        if (in_array("Class XII", $sub_res) && $option [0]->x2 != '')
                                                                            $sub_res_arr [] = 'Class XII (Academic Year ' . $option [0]->x2 . ')';
                                                                        $res_result [] = 'Education of children - ' . implode(',', $sub_res_arr);
                                                                    }
                                                                    if ($lres == 5)
                                                                        $res_result [] = 'Others';
                                                                }
                                                                ?>
                                                                <?php echo implode(' | ', $res_result); ?>
                                                            </td>
                                                            <td><?php
                                                                switch ($officer_data->option_status) {
                                                                    case 1: echo 'Unfilled';
                                                                        break;
                                                                    case 2: echo 'Pending at CCA';
                                                                        break;
                                                                    case 3: echo 'CCA Approved';
                                                                        break;
                                                                    case 4: echo 'CCA Rejected';
                                                                        break;
                                                                    case 5: echo 'DBC Printed';
                                                                        break;
                                                                    case 6: echo 'Closed';
                                                                        break;
                                                                }
                                                                ?></td>
                                                            <td><?php
                                                                if ($option[0]->modified_on != '')
                                                                    echo date('d-m-Y', $option[0]->modified_on);
                                                                else if ($option[0]->created_on != '')
                                                                    echo date('d-m-Y', $option[0]->created_on);
                                                                else
                                                                    echo '';
                                                                ?></td>
                                                            <td colspan="2"><?php echo $option_detail->option_no; ?></td>
                                                            <td><?php echo stripslashes($officer_data->dbc_remark); ?></td>
                                                        </tr>
                                                        <tr>
                                                            <th colspan="3">Specification</th>
                                                            <th colspan="2">CCA Remarks</th>
															<th colspan="2">Uploaded File(If any)</th>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="3" class="specification"><?php if ($option[0]->spousespecification != '') { ?>
                                                                    <strong>Working spouse: </strong><?php
                                                                    echo $option[0]->spousespecification . '<br />';
                                                                }
                                                                ?>
                                                                <?php if ($option[0]->medicalspecification != '') { ?>
                                                                    <strong>Medical grounds: </strong><?php
                                                                    echo $option[0]->medicalspecification . '<br />';
                                                                }
                                                                ?>
                                                                <?php if ($option[0]->childrenspecification != '') { ?>
                                                                    <strong>Education of children: </strong><?php
                                                                    echo $option[0]->childrenspecification . '<br />';
                                                                }
                                                                ?>
                                                                <?php if ($option[0]->othersspecification != '') { ?>
                                                                    <strong>Others: </strong><?php
                                                                    echo $option[0]->othersspecification . '<br />';
                                                                }
                                                                ?></td>
                                                            <td colspan="2" class="cca-remarks"><?php echo stripslashes($officer_data->cca_remark); ?></td>
															 <td colspan="2" class="file-uploaded">
                                                            <?php
															
                                                            if (!empty($option[0]->myfile)) {
                                                                ?>
                                                                <a href="uploads/prooffoption/<?php echo $option[0]->myfile; ?>" target="_blank">
                                                                    Click to see
                                                                </a>
                                                            <?php } ?>
                                                        </td>
                                                        </tr>   
                                                        <?php $l = $l + 1; ?>

                                                    <?php } ?>

                                                <?php } else { ?>
                                                    <tr class="norecords">
                                                        <td colspan="7">No records found.</td>
                                                    </tr>

                                                <?php } ?>
                                                </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <?php if (!empty($officer_list)) { ?>
                                            <ul class="buttons-strip">
                                                <li class="buttonbar"><input type="button"
                                                                             id="download_as_excel" name="download_as_excel"
                                                                             value="Export" /> <input type="button"
                                                                             id="download_as_excel_export" name="download_as_excel_export"
                                                                             value="Export to Print" /> <input type="button"
                                                                             id="change_option_status_button"
                                                                             name="change_option_status_button"
                                                                             value="Change Option Status" /> <input type="button"
                                                                             id="update_dbc_remark_button" name="update_dbc_remark_button"
                                                                             value="Add/Edit DBC Remark" /></li>
                                            </ul>
                                        <?php } ?>
                                        <div id="dialog" style="display: none"
                                             class="popupbox">
                                            <h2>Add/Change DBC Remarks</h2>
                                            <ul class="owr-resultbot">
                                                <li><label>DBC Remarks</label> <textarea
                                                        id="dbc_remark_all_add" name="dbc_remark_all_add"
                                                        class="text-area" rows="4" cols="34"></textarea></li>
                                                <li><label>Replace existing remark</label> <input
                                                        type="checkbox" id="replace_existing_add"
                                                        name="replace_existing_add" value="1" /></li>
                                                <li class="buttonbar"><label>&nbsp;</label> <input
                                                        type="button" id="update_dbc_remark"
                                                        name="update_dbc_remark" value="Save" /> <input
                                                        type="button" id="update_dbc_remark_cancel"
                                                        name="update_dbc_remark_cancel" value="Cancel" /></li>
                                            </ul>
                                        </div>
                                        <div id="optiondialog" style="display: none" class="popupbox">
                                            <h2>Change Option Status</h2>
                                            <ul class="owr-resultbot">
                                                <li><label>Option Status</label> <select
                                                        id="option_status_form" name="option_status_form"
                                                        class="list-menu">
                                                        <option value="">Select Option Status</option>
                                                        <?php
                                                        foreach ($option_status_arr as $key => $val) {
                                                            echo '<option value="' . $key . '"';
                                                            echo '>' . $val . '</option>';
                                                        }
                                                        ?>
                                                    </select></li>
                                                <li><label>DBC Remarks</label> 
                                                    <textarea id="dbc_remark_all" name="dbc_remark_all" class="text-area" rows="4" cols="34"></textarea>
                                                </li>
                                                <li><label>Replace existing remark</label> 
                                                    <input type="checkbox" id="replace_existing" name="replace_existing" value="1" />
                                                </li>
                                                <li class="buttonbar"><label>&nbsp;</label>
                                                    <input type="button" id="change_option_status" name="change_option_status" value="Save" />
                                                    <input  type="button" id="change_option_status_cancel" name="change_option_status_cancel" value="Cancel" />
                                                </li>
                                            </ul>
                                        </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <?php include('includes/footer.php'); ?>

        <script type="text/javascript">
                jQuery(document).ready(function () {
                    $.noConflict();
                    //alert($().jquery);
                    /* Dialog on add dbc remarks */
                    $('#update_dbc_remark_button').click(function () {
                        if ($('[name="cb[]"]:checked').length > 0) {

                            $('#dialog').dialog();
                        } else {
                            alert('Please select some records to change option status / add dbc remarks.')
                        }
                    });
                    $('#change_option_status_button').click(function () {
                        if ($('[name="cb[]"]:checked').length > 0) {

                            $('#optiondialog').dialog();
                            /*if($('.ui-dialog-titlebar').length > 0){
                             $('.ui-dialog-titlebar').wrap('<div class="popup-window"></div>');
                             $('.popup-window').append($('#optiondialog').html());
                             $('.ui-dialog-content').remove();
                             }*/
                        } else {
                            alert('Please select some records to change option status / add dbc remarks.')
                        }
                    });
                    /* End dbc remark */

                    if ($('#replace_existing').length > 0) {
                        $("#replace_existing").change(function () {
                            if (this.checked) {
                                $("#replace_existing_hidden").val('1');
                            } else {
                                $("#replace_existing_hidden").val('');
                            }
                        });
                    }

                    if ($('#update_dbc_remark_cancel').length > 0) {
                        $('#update_dbc_remark_cancel').click(function () {
                            $('.ui-dialog-titlebar-close').click();
                        });
                    }

                    if ($('#change_option_status_cancel').length > 0) {
                        $('#change_option_status_cancel').click(function () {
                            $('.ui-dialog-titlebar-close').click();
                        });
                    }

                });
        </script>
    </body>
</html>
